
@using API.Models

@{
    Layout = "~/Views/Shared/DashboardLayout.cshtml";
}

@{
    bool IsApiActive = false;
    int Requests = 0;
    float RequestsPercent = 0;
    string ApiKey = "";
    int ClientId = ((ViewBag.Client as IEnumerable<Client>).First().Id);
    DateTime? DateCreated = null;

    if (ViewBag.ApiKey.Count > 0) {
        IsApiActive = ((ViewBag.ApiKey as IEnumerable<ApiKey>).First().IsActive);
        Requests = ((ViewBag.ApiKey as IEnumerable<ApiKey>).First().AmountOfRequests);
        RequestsPercent = (Requests / 10000.0f) * 100;
        ApiKey = ((ViewBag.ApiKey as IEnumerable<ApiKey>).First().Key);
        DateCreated = DateTime.Parse(((ViewBag.ApiKey as IEnumerable<ApiKey>).First().DateCreated.ToString()));
    } 
}

<div class="alert alert-warning" role="alert">
    Do not share your API key with anyone. If your API key becomes compromised <a href="/Dashboard/Settings" class="link-primary"><strong>Disable</strong></a> your key and contact <code>support@ecommerce-api.net</code>.
</div>

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
        <li class="breadcrumb-item active" aria-current="page">Overview</li>
    </ol>
</nav>
<div class="d-inline-flex flex-grow-1 w-100 gap-5 flex-wrap">
    <div class="card text-bg-light mb-3 flex-grow-1">
        <div class="card-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-key-fill" viewBox="0 0 16 16">
                <path d="M3.5 11.5a3.5 3.5 0 1 1 3.163-5H14L15.5 8 14 9.5l-1-1-1 1-1-1-1 1-1-1-1 1H6.663a3.5 3.5 0 0 1-3.163 2M2.5 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2" />
            </svg>
            API Key <span class="text-secondary ps-2">Generated at @DateCreated</span>
        </div>
        <div class="card-body">
            @if (string.IsNullOrEmpty(ApiKey)) {
                <p>CALL using AJAX.</p>
                <a href="/Dashboard/GenerateApiKey/?ClientId=@ClientId" class="btn btn-success">Generate API Key</a>
            }
            else {
                <p class="text-center">@ApiKey</p>
            }
        </div>
    </div>
    <div class="card text-bg-light mb-3 flex-grow-1">
        <div class="card-header">
            <div class="d-inline-flex justify-content-between w-100">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pie-chart-fill" viewBox="0 0 16 16">
                        <path d="M15.985 8.5H8.207l-5.5 5.5a8 8 0 0 0 13.277-5.5zM2 13.292A8 8 0 0 1 7.5.015v7.778zM8.5.015V7.5h7.485A8 8 0 0 0 8.5.015" />
                    </svg>
                    API Usage Statistics
                </div>
                @if (IsApiActive) {<span class="badge text-bg-success">Active</span> }
                else { <span class="badge text-bg-danger">Disabled</span>}
            </div>
        </div>
        <div class="card-body">
            <p>@Requests / 10,000 Requests</p>
            <div class="progress" role="progressbar" aria-label="Basic example" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar" style="width: @RequestsPercent%"></div>
            </div>
        </div>
    </div>
</div>

